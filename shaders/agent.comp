#version 460 core

layout(local_size_x = 1, local_size_y = 1, local_size_z = 1) in;

layout(rgba32f, binding = 0) uniform image2D image;
layout(std430, binding = 1) buffer agentPositionsBuffer { vec2 agentPositions[]; };
layout(std430, binding = 2) buffer agentDirectionsBuffer { vec2 agentDirections[]; };

uniform float agentSpeed;

void main() {
	int index = int(gl_GlobalInvocationID);

	vec2 agentPosition = agentPositions[index].xy;
	vec2 agentDirection = agentDirections[index].xy;

	agentPosition = agentPosition + agentDirection * agentSpeed;
	agentPositions[index].xy = agentPosition;

	if (agentPosition.x > 1.0) {
		agentDirection.x *= -1.0;
	} else if (agentPosition.x < -1.0) {
		agentDirection.x *= -1.0;
	}

	if (agentPosition.y > 1.0) {
		agentDirection.y *= -1.0;
	} else if (agentPosition.y < -1.0) {
		agentDirection.y *= -1.0;
	}

	agentDirections[index] = agentDirection;
}
